{"id":"bestiary-4jh","content_hash":"5e17bb4fc16be6af2df15aef58b8035321a209d437ee52660f0e640b0b8950d2","title":"Fix duplicate Footer component causing two copyright dates","description":"## Problem\nThe webapp footer displays two copyright dates. Investigation found **two duplicate Footer component implementations**:\n\n1. `webapp/src/components/Footer.tsx` (active, imported by layout)\n2. `webapp/src/components/Footer/Footer.tsx` (newer, with env var fallback)\n\nBoth have identical CSS files:\n- `webapp/src/components/css/Footer.css`\n- `webapp/src/components/Footer/Footer.css`\n\n## Root Cause\nGit history shows commit b033429 added the subdirectory structure but didn't delete the old files. The layout imports `../components/Footer` which TypeScript resolves to the `.tsx` file over the directory.\n\nBoth CSS files get loaded, causing duplicate rendering.\n\n## Fix\n1. Delete `webapp/src/components/Footer.tsx`\n2. Delete `webapp/src/components/css/Footer.css`\n3. Update `webapp/src/layouts/layout.tsx` line 3:\n   ```typescript\n   // FROM:\n   import { Footer } from \"../components/Footer\";\n   // TO:\n   import { Footer } from \"../components/Footer/Footer\";\n   ```\n\n## Files\n- webapp/src/components/Footer.tsx (DELETE)\n- webapp/src/components/css/Footer.css (DELETE)\n- webapp/src/components/Footer/Footer.tsx (KEEP)\n- webapp/src/components/Footer/Footer.css (KEEP)\n- webapp/src/layouts/layout.tsx:3 (UPDATE import)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T13:38:46.570615-05:00","updated_at":"2026-01-31T14:03:57.226699-05:00","closed_at":"2026-01-31T14:03:57.226699-05:00","source_repo":"."}
{"id":"bestiary-6jd","content_hash":"b328445956b1a6da3436fb15c53a1a0e5bf1720a11c3540cf23adfc5493d7aa2","title":"Investigate missing generator email","description":"## Problem\nNo email received from generator function this morning (expected at 11:00 UTC).\n\n## Email Implementation\n- **File**: `generator/src/utils/mail.ts` (lines 29-67)\n- Uses nodemailer with AWS SES transport\n- Called in pipeline at `generator/src/index.ts` lines 82-87:\n```typescript\nmail.factSheet({\n  from: MAIL_FROM,\n  to: MAIL_TO,\n  subject: \\`Daily \\${ENTITY}\\`,\n  header: \\`Your daily \\${ENTITY} is here\\`\n})\n```\n\n## Critical Configuration Issues Found\n\n### 1. Parameter Path Mismatch\n**samconfig.toml** references `/UNICORN/` paths:\n```\nMAILTO = \"/UNICORN/MAIL_TO\"\nMAILFROM = \"/UNICORN/MAIL_FROM\"\n```\n\n**template.yaml** defaults reference `/BESTIARY/` paths:\n```yaml\nDefault: '{{resolve:ssm:/BESTIARY/MAIL_TO}}'\nDefault: '{{resolve:ssm:/BESTIARY/MAIL_FROM}}'\n```\n\nIf SSM parameters exist under `/BESTIARY/` but not `/UNICORN/`, environment variables will be empty.\n\n### 2. Missing IDENTITY Parameter\n**template.yaml** defines IDENTITY parameter for SES policy:\n```yaml\nIDENTITY:\n  Type: String\n  Default: '{{resolve:ssm:/BESTIARY/IDENTITY}}'\n```\nBut **samconfig.toml** doesn't include IDENTITY in parameter_overrides.\n\n### 3. No Error Handling\n`mail.ts` line 63 has no try-catch around `await transporter.sendMail(params)`.\nAny error crashes the Lambda silently.\n\n### 4. Environment Validation\n`index.ts` lines 8-10 validate env vars at startup:\n```typescript\nconst { STORAGE_BUCKET, ENTITY, MAIL_FROM, MAIL_TO } = validate.environment([\n  'STORAGE_BUCKET', 'ENTITY', 'MAIL_TO', 'MAIL_FROM'\n]);\n```\nIf MAIL_TO or MAIL_FROM are empty, the Lambda crashes immediately.\n\n## Schedule\nCron: `cron(0 11 * * ? *)` - 11:00 AM UTC daily\n\n## Investigation Steps\n1. Check CloudWatch logs: `/aws/lambda/unicorn-io-UnicornProxyFn-*`\n2. Look for:\n   - \"Required environment variable not found\"\n   - SES errors\n   - Uncaught exceptions\n3. Verify SSM Parameter Store:\n   - Check if `/UNICORN/MAIL_TO` exists\n   - Check if `/UNICORN/MAIL_FROM` exists\n   - Check if sender is SES-verified\n4. Check SES:\n   - Verified identities for MAIL_FROM domain\n   - Sending limits (sandbox mode?)\n   - Region matches (us-east-1)\n\n## Files\n- generator/src/utils/mail.ts (email implementation)\n- generator/src/index.ts:8-10 (env validation), :82-87 (email trigger)\n- generator/src/utils/fn.ts:32-43 (pipeline error handling - not used)\n- generator/src/utils/validate.ts:4-10 (env validation that crashes)\n- generator/template.yaml:5-36 (CloudFormation parameters)\n- generator/samconfig.toml:1-11 (deployment config)\n\n## Potential Fixes\n1. Align SSM paths between samconfig.toml and template.yaml\n2. Add try-catch around email sending in mail.ts\n3. Add IDENTITY to samconfig.toml parameter_overrides\n4. Consider adding pipeline error handler for graceful failures","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T13:46:18.441965-05:00","updated_at":"2026-01-31T14:37:36.100636-05:00","closed_at":"2026-01-31T14:37:36.100636-05:00","source_repo":"."}
{"id":"bestiary-6sb","content_hash":"8e710a8293d45b85fa6bb8a34e244852639017b4c8ab29ef05e680caea3e5f7b","title":"Clean up Buttons/buttons git case-sensitivity issue","description":"## Problem\nGit is tracking BOTH `webapp/src/components/Buttons/` (capital B) and `webapp/src/components/buttons/` (lowercase b) directories. This is a case-sensitivity issue that works on macOS but could break on Linux CI/CD.\n\n## Current State\n`git ls-files` shows duplicate entries:\n```\nwebapp/src/components/Buttons/CopyButton.tsx\nwebapp/src/components/buttons/CopyButton.tsx\n...\n```\n\nCommit 9fd2e19 partially fixed this by removing `Buttons/css/NavigationButtons.css`, but other files remain duplicated.\n\n## Fix Required\n1. Determine canonical casing (likely lowercase `buttons/` to match imports)\n2. Remove duplicate entries from git index\n3. Ensure all imports use consistent casing\n4. Verify on case-sensitive filesystem (Linux) if possible\n\n## Files Affected\n- webapp/src/components/Buttons/ (or buttons/)\n- All imports referencing this directory\n\n## Related\n- Commit 9fd2e19 - Partial fix for NavigationButtons.css","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-02-01T13:38:35.97999-05:00","updated_at":"2026-02-01T13:43:15.597787-05:00","closed_at":"2026-02-01T13:43:15.597787-05:00","source_repo":"."}
{"id":"bestiary-90h","content_hash":"7af6378e27c832d3d37a7f8d2d8df7e076619aec2dd2ab89e78157722fc0c79b","title":"Investigate entity 823 display issue","description":"## Problem\nEntity 823 at https://thebestiary.fyi/entity/823 may have a display issue.\n\n## How Entities Work\n- Stored in S3 with key format: `{timestamp}-{imageModelId}-{textModelId}-\"{subject}\"-\"{adjectives}\"-\"{setting}\"-\"{style}`\n- Each entity has `img.png` and `desc.json` files\n- `manifest.json` contains array of all entity base paths\n- Entity ID = array index (0-based), so entity 823 is item 824 in manifest\n\n## Recent Fixes (may be relevant)\n- **df7063d** (2026-01-30): Fixed URL encoding for S3 keys with special characters\n- **bdb499f** (2026-01-30): Fixed model ID selection timing - was causing mismatched S3 paths\n- **5d5d4c9** (2025-11-22): Fixed S3 pagination \u003e1000 items, graceful error handling for missing desc.json\n\n## Error Handling\nEntity route has fallback - if desc.json fails to load, entity displays with empty metadata fields:\n```typescript\nconst descDefault = {\n  name: \"\", scientific_name: \"\", diet: \"\", habitat: \"\", \n  size: \"\", coloration: \"\", lifespan: \"\", fun_fact: \"\",\n  special_abilities: \"\", model: \"\", date: \"\", prompt: \"\"\n};\n```\n\n## Possible Causes\n1. Image exists but description missing\n2. Both files missing (404 on image)\n3. S3 key encoding issue (special characters)\n4. Manifest out of sync\n5. Model ID mismatch (image/desc have different paths)\n\n## Investigation Steps\n1. Check if entity 823 is in current manifest.json\n2. Query S3 directly for entity files\n3. Check CloudWatch logs around entity 823 creation time\n4. If image exists but no desc.json, run describe script to regenerate\n\n## Files\n- webapp/src/routes/entity/$id.tsx - Entity route handler\n- webapp/src/hooks/useManifest.tsx - Fetches manifest.json\n- webapp/src/utils/cfurl.ts - URL construction\n- generator/src/scripts/describe.ts - CLI to regenerate descriptions\n- generator/src/scripts/backfill.ts - Batch backfill for missing descriptions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T13:38:47.425879-05:00","updated_at":"2026-02-01T13:24:14.359176-05:00","closed_at":"2026-02-01T13:24:14.359176-05:00","source_repo":"."}
{"id":"bestiary-cgm","content_hash":"062a1907e2e0d9b1507a043ff2106182db8dfbd2f48d96cb39f43be5fa5f2ff5","title":"Improve entity card responsiveness on mobile","description":"## Summary\nThe entity card has responsive styling but several gaps on small screens.\n\n## Current Implementation\n- Pure CSS media queries (no Tailwind)\n- Breakpoints: 480px, 640px, 768px, 1024px, 1280px\n- Mobile-first: card stacks vertically, switches to row at 1024px\n- Image scales: 300px → 384px → 640px → 768px across breakpoints\n\n## Identified Issues\n\n### Critical\n1. **Wrapper layout not responsive** (`entity.css` lines 1-6)\n   - Always `flex-direction: row` even on mobile\n   - Arrows + card cramped on screens \u003c480px\n\n2. **Details grid fixed margin** (`EntityCard.css` line 54)\n   - Fixed `margin-left: 1.5rem` doesn't scale\n\n3. **Card content fixed max-height** (`EntityCard.css` line 29)\n   - `max-height: 80vh` causes excessive scrolling on small screens\n\n4. **Arrow button positioning** (`NavigationButtons.css` lines 4-5)\n   - Fixed `margin-top/bottom: 45vh` - no space for card on mobile\n\n### Minor\n5. CardFooter has no responsive styling (fixed `font-size: 0.75rem`)\n6. Scientific name doesn't scale (`font-size: 0.875rem`)\n7. Card header buttons may wrap unpredictably\n\n## Files\n- webapp/src/routes/entity/entity.css (wrapper)\n- webapp/src/components/EntityCard/css/EntityCard.css\n- webapp/src/components/EntityCard/css/Image.css\n- webapp/src/components/EntityCard/css/CardFooter.css\n- webapp/src/components/Buttons/css/NavigationButtons.css\n- webapp/src/components/Buttons/css/CardButtons.css\n\n## Recommendations\n1. Stack arrows vertically on mobile\n2. Responsive margins/padding for details grid\n3. Viewport-relative max-height for card content\n4. Add responsive styling to metadata/footer\n5. Explicit flex-wrap control for buttons\n6. Reduce arrow button margins on mobile","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T13:38:47.003986-05:00","updated_at":"2026-02-01T13:30:24.998047-05:00","closed_at":"2026-02-01T13:30:24.998047-05:00","source_repo":"."}
